"use strict";exports.id=3927,exports.ids=[3927],exports.modules={63927:(e,t,s)=>{s.d(t,{Z:()=>N});var r=s(10326),l=s(17577),a=s.n(l),o=s(28932),i=s(21405),n=s(86333),d=s(39183),c=s(95920),m=s(83855),h=s(63685),x=s(32933),u=s(94019),g=s(75290),p=s(65983),f=s(98091),b=s(71709),y=s(46226),j=s(40381);let N=({images:e,onImagesChange:t,multiple:s=!0,maxImages:N=10,label:w="Images"})=>{let[v,Z]=(0,l.useState)("root"),[C,P]=(0,l.useState)([]),[D,k]=(0,l.useState)([]),[E,F]=(0,l.useState)(!1),[S,$]=(0,l.useState)(!1),[T,I]=(0,l.useState)(!1),[R,L]=(0,l.useState)(""),[O,U]=(0,l.useState)(["root"]),A=(0,l.useRef)(null),B=async(e=v)=>{F(!0);try{let t="root"===e?"/api/upload/folders":`/api/upload/folders?path=${encodeURIComponent(e)}`,s=await fetch(t);if(s.ok){let e=await s.json();P(e.folders||[])}let r="root"===e?"/api/upload/list":`/api/upload/list?folder=${encodeURIComponent(e)}`,l=await fetch(r);if(l.ok){let e=await l.json(),t=e.images?.map(e=>e.url)||[];k(t)}}catch(e){console.error("Error loading path:",e),j.ZP.error("Failed to load folder contents")}finally{F(!1)}};(0,l.useEffect)(()=>{B()},[v]);let K=e=>{Z(e),U(t=>[...t,e])},M=(e,t)=>{Z(e),U(e=>e.slice(0,t+1))},J=async()=>{if(!R.trim()){j.ZP.error("Please enter a folder name");return}F(!0);try{let e=await fetch("/api/upload/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderName:R.trim(),parentPath:"root"===v?void 0:v})});if(e.ok)L(""),I(!1),j.ZP.success("Folder created successfully"),B();else{let t=await e.json();j.ZP.error(t.error||"Failed to create folder")}}catch(e){console.error("Error creating folder:",e),j.ZP.error("Failed to create folder")}finally{F(!1)}},q=async(e,t)=>{t.stopPropagation();let s=e.name;if(confirm(`⚠️ Delete folder "${s}"?

This will delete the folder and ALL contents including:
- All images in this folder
- All subfolders and their contents

This action cannot be undone.

Click OK to confirm deletion.`)){F(!0),console.log("Deleting folder:",e.fullPath);try{let t=await fetch(`/api/upload/folders?path=${encodeURIComponent(e.fullPath)}`,{method:"DELETE"});if(console.log("Delete response status:",t.status),t.ok){let e=await t.json();console.log("Delete result:",e),j.ZP.success(`Folder "${s}" deleted successfully`),B()}else{let e=await t.json();console.error("Delete error response:",e),j.ZP.error(e.error||"Failed to delete folder")}}catch(e){console.error("Error deleting folder:",e),j.ZP.error("Network error: Failed to delete folder")}finally{F(!1)}}},z=async(s,r)=>{r.stopPropagation();let l=s.split("/").pop()||"image";if(confirm(`⚠️ Delete image "${l}"?

This action cannot be undone.

Click OK to confirm deletion.`)){F(!0);try{let r=await fetch("/api/upload/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:s})});if(r.ok)e.includes(s)&&t(e.filter(e=>e!==s)),j.ZP.success("Image deleted successfully"),B();else{let e=await r.json();j.ZP.error(e.error||"Failed to delete image")}}catch(e){console.error("Error deleting image:",e),j.ZP.error("Failed to delete image")}finally{F(!1)}}},H=async r=>{if(!r)return;let l=Array.from(r).filter(e=>e.type.startsWith("image/")&&e.size<=5242880);if(0===l.length){j.ZP.error("Please select valid image files (less than 5MB)");return}if(!s&&l.length>1){j.ZP.error("Please select only one image");return}if(s&&e.length+l.length>N){j.ZP.error(`Maximum ${N} images allowed`);return}$(!0);try{let r=l.map(async e=>{let t=new FormData;t.append("file",e),t.append("folder",v);let s=await fetch("/api/upload",{method:"POST",body:t});if(!s.ok)throw Error("Upload failed");return(await s.json()).url}),a=await Promise.all(r);s?t([...e,...a]):t(a);let o="root"===v?"root folder":v;j.ZP.success(`Successfully uploaded ${a.length} image(s) to ${o}`),B()}catch(e){console.error("Error uploading images:",e),j.ZP.error("Error occurred while uploading images")}finally{$(!1)}},W=r=>{if(s){if(e.includes(r))t(e.filter(e=>e!==r));else{if(e.length>=N){j.ZP.error(`Maximum ${N} images allowed`);return}t([...e,r])}}else t([r])},G=()=>O.map((e,t)=>({name:"root"===e?"Home":e.split("/").pop()||e,path:e,index:t}));return(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(o.Z,{className:"h-5 w-5 mr-2 text-blue-600"}),"\uD83D\uDCC1 ",w," Explorer"]}),r.jsx("div",{className:"flex items-center space-x-2",children:r.jsx("button",{type:"button",onClick:()=>B(),disabled:E,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-white rounded-lg transition-colors",title:"Refresh",children:r.jsx(i.Z,{className:`h-4 w-4 ${E?"animate-spin":""}`})})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[r.jsx("button",{type:"button",onClick:()=>{if(O.length>1){let e=[...O];e.pop();let t=e[e.length-1];U(e),Z(t)}},disabled:O.length<=1,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Back",children:r.jsx(n.Z,{className:"h-4 w-4"})}),r.jsx("div",{className:"flex items-center space-x-1 bg-white rounded-lg px-3 py-2 border flex-1",children:G().map((e,t)=>(0,r.jsxs)(a().Fragment,{children:[t>0&&r.jsx(d.Z,{className:"h-3 w-3 text-gray-400"}),r.jsx("button",{type:"button",onClick:()=>M(e.path,e.index),className:`text-sm px-2 py-1 rounded hover:bg-gray-100 transition-colors ${t===G().length-1?"text-blue-600 font-medium":"text-gray-600 hover:text-gray-800"}`,children:0===t?(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(c.Z,{className:"h-3 w-3 mr-1"}),e.name]}):e.name})]},e.path))})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>I(!0),disabled:E,className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm disabled:opacity-50",children:[r.jsx(m.Z,{className:"h-4 w-4 mr-1"}),"New Folder"]}),(0,r.jsxs)("button",{type:"button",onClick:()=>A.current?.click(),disabled:S,className:"flex items-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm disabled:opacity-50",children:[r.jsx(h.Z,{className:"h-4 w-4 mr-1"}),S?"Uploading...":"Upload Images"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["\uD83D\uDCC2 ","root"===v?"Root Folder":v," •",C.length," folder(s) • ",D.length," image(s)"]})]}),T&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-white rounded-lg border",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"text",value:R,onChange:e=>L(e.target.value),placeholder:"Enter folder name...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm",onKeyPress:e=>"Enter"===e.key&&J(),autoFocus:!0}),r.jsx("button",{type:"button",onClick:J,disabled:E||!R.trim(),className:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:r.jsx(x.Z,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",onClick:()=>{I(!1),L("")},className:"px-3 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors",children:r.jsx(u.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("p",{className:"text-xs text-blue-600 mt-2",children:["\uD83D\uDCA1 Creating folder in: ","root"===v?"Root":v]})]})]}),r.jsx("div",{className:"p-4",children:E?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(g.Z,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"Loading folder contents..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[C.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center",children:[r.jsx(p.Z,{className:"h-4 w-4 mr-2 text-blue-500"}),"\uD83D\uDCC1 Folders (",C.length,")"]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3",children:C.map(e=>(0,r.jsxs)("div",{className:"group relative bg-gray-50 hover:bg-blue-50 rounded-lg p-3 cursor-pointer transition-colors border border-gray-200 hover:border-blue-300",children:[(0,r.jsxs)("div",{onClick:()=>K(e.fullPath),className:"text-center",children:[r.jsx(p.Z,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),r.jsx("p",{className:"text-xs text-gray-500",children:"supabase"===e.source?"☁️ Cloud":"\uD83D\uDCBB Local"})]}),r.jsx("button",{type:"button",onClick:t=>q(e,t),className:"absolute top-2 right-2 p-2 bg-red-500 text-white hover:bg-red-600 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-lg hover:shadow-xl",title:"Delete folder",disabled:E,children:r.jsx(f.Z,{className:"h-4 w-4"})})]},e.fullPath))})]}),D.length>0?(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center",children:[r.jsx(b.Z,{className:"h-4 w-4 mr-2 text-green-500"}),"\uD83D\uDDBC️ Images (",D.length,")"]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:D.map((t,s)=>{let l=e.includes(t);return(0,r.jsxs)("div",{onClick:()=>W(t),className:`relative group cursor-pointer rounded-lg overflow-hidden border-2 transition-all duration-200 ${l?"border-green-500 ring-2 ring-green-200 shadow-lg":"border-gray-200 hover:border-blue-500 hover:shadow-md"}`,children:[(0,r.jsxs)("div",{className:"aspect-square relative bg-gray-100",children:[r.jsx(y.default,{src:t,alt:`Image ${s+1}`,fill:!0,className:"object-cover"}),l&&r.jsx("div",{className:"absolute inset-0 bg-green-500 bg-opacity-20 flex items-center justify-center",children:r.jsx("div",{className:"bg-green-500 text-white rounded-full p-1",children:r.jsx(x.Z,{className:"h-4 w-4"})})}),r.jsx("button",{type:"button",onClick:e=>z(t,e),className:"absolute top-2 right-2 p-2 bg-red-500 text-white hover:bg-red-600 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-lg hover:shadow-xl",title:"Delete image",disabled:E,children:r.jsx(f.Z,{className:"h-3 w-3"})})]}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-white p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx("p",{className:"text-xs truncate",children:t.split("/").pop()})})]},s)})})]}):0===C.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx(o.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500 mb-2",children:"This folder is empty"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create folders or upload images to get started"})]}):(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx(b.Z,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"No images in this folder"})]})]})}),e.length>0&&r.jsx("div",{className:"border-t bg-gray-50 p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(x.Z,{className:"h-4 w-4 text-green-600 mr-2"}),(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.length," image(s) selected"]})]}),r.jsx("button",{type:"button",onClick:()=>t([]),className:"text-sm text-red-600 hover:text-red-800 underline",children:"Clear Selection"})]})}),r.jsx("input",{ref:A,type:"file",accept:"image/*",multiple:s,onChange:e=>H(e.target.files),className:"hidden"})]})}}};