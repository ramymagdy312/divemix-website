(()=>{var e={};e.id=6475,e.ids=[6475],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},40852:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>S,patchFetch:()=>b,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>j,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{DELETE:()=>h,GET:()=>f,POST:()=>m});var s=t(49303),a=t(88716),l=t(60670),n=t(87070),i=t(89145),c=t(92048),u=t.n(c),d=t(55315),p=t.n(d);async function f(e){try{let{searchParams:r}=new URL(e.url),t=r.get("path")||"",o=[],s=t?`uploads/${t}`:"uploads";try{let{data:e,error:r}=await i.O.storage.from("images").list(s,{limit:1e3,offset:0});if(!r&&e){let r=new Set;for(let t of e)if(t.name&&".emptyFolderPlaceholder"!==t.name){if(t.name.includes(".")||t.metadata?.size){if(t.name.includes("/")){let e=t.name.split("/")[0];r.add(e)}}else r.add(t.name)}r.forEach(e=>{let r=t?`${t}/${e}`:e;o.push({name:e,path:`uploads/${r}`,fullPath:r,parentPath:t,source:"supabase",createdAt:new Date().toISOString(),isNested:t.length>0})})}}catch(e){console.log("Supabase storage not available, checking local folders...")}try{let e=p().join(process.cwd(),"public","uploads"),r=t?p().join(e,t):e;if(u().existsSync(r)){for(let e of u().readdirSync(r,{withFileTypes:!0}).filter(e=>e.isDirectory()))if(!o.find(r=>r.name===e.name)){let s=p().join(r,e.name),a=u().statSync(s),l=t?`${t}/${e.name}`:e.name;o.push({name:e.name,path:`uploads/${l}`,fullPath:l,parentPath:t,source:"local",createdAt:a.birthtime.toISOString(),isNested:t.length>0})}}}catch(e){console.log("Local uploads folder not accessible")}return o.sort((e,r)=>e.name.localeCompare(r.name)),n.NextResponse.json({success:!0,folders:o})}catch(e){return console.error("Error fetching folders:",e),n.NextResponse.json({error:"Failed to fetch folders"},{status:500})}}async function m(e){try{let{folderName:r,parentPath:t}=await e.json();if(!r||"string"!=typeof r)return n.NextResponse.json({error:"Folder name is required"},{status:400});let o=r.toLowerCase().replace(/[^a-z0-9-_]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");if(!o)return n.NextResponse.json({error:"Invalid folder name"},{status:400});let s=t?`${t}/${o}`:o;try{let e=new Uint8Array([]),{data:r,error:a}=await i.O.storage.from("images").upload(`uploads/${s}/.emptyFolderPlaceholder`,e,{contentType:"text/plain"});if(a)return console.error("Supabase folder creation error:",a),n.NextResponse.json({error:"Failed to create folder in Supabase"},{status:500});return n.NextResponse.json({success:!0,folder:{name:o,path:`uploads/${s}`,fullPath:s,parentPath:t||"",source:"supabase",createdAt:new Date().toISOString(),isNested:!!t}})}catch(e){try{let e=p().join(process.cwd(),"public","uploads"),r=p().join(e,s);if(!u().existsSync(r))return u().mkdirSync(r,{recursive:!0}),n.NextResponse.json({success:!0,folder:{name:o,path:`uploads/${s}`,fullPath:s,parentPath:t||"",source:"local",createdAt:new Date().toISOString(),isNested:!!t}});return n.NextResponse.json({error:"Folder already exists"},{status:400})}catch(e){return console.error("Local folder creation error:",e),n.NextResponse.json({error:"Failed to create folder"},{status:500})}}}catch(e){return console.error("Error creating folder:",e),n.NextResponse.json({error:"Unexpected error occurred"},{status:500})}}async function h(e){try{let{searchParams:r}=new URL(e.url),t=r.get("path");if(!t)return n.NextResponse.json({error:"Folder path is required"},{status:400});try{let e=async r=>{console.log(`Deleting folder: ${r}`);let{data:t,error:o}=await i.O.storage.from("images").list(`uploads/${r}`,{limit:1e3,offset:0});if(o){console.error("Error listing folder contents:",o);return}if(t&&t.length>0){let o=[],s=[];for(let e of t)if(e.name){let t=`uploads/${r}/${e.name}`;e.name.includes(".")||e.metadata?.size!==void 0||".emptyFolderPlaceholder"===e.name?(o.push(t),console.log(`Adding file to delete: ${t}`)):(s.push(`${r}/${e.name}`),console.log(`Adding folder to delete: ${r}/${e.name}`))}if(o.length>0){console.log(`Deleting ${o.length} files:`,o);let{error:e}=await i.O.storage.from("images").remove(o);e?console.error("Error deleting files:",e):console.log("Files deleted successfully")}for(let r of s)await e(r)}let s=`uploads/${r}/.emptyFolderPlaceholder`;console.log(`Attempting to delete placeholder: ${s}`);let{error:a}=await i.O.storage.from("images").remove([s]);a?console.log("Placeholder file not found or already deleted:",a):console.log("Placeholder file deleted successfully")};return await e(t),console.log(`Folder deletion completed for: ${t}`),n.NextResponse.json({success:!0,message:`Folder '${t}' deleted successfully`})}catch(e){console.error("Supabase deletion error:",e);try{let e=p().join(process.cwd(),"public","uploads"),r=p().join(e,t);return u().existsSync(r)&&u().rmSync(r,{recursive:!0,force:!0}),n.NextResponse.json({success:!0})}catch(e){return console.error("Local folder deletion error:",e),n.NextResponse.json({error:"Failed to delete folder"},{status:500})}}}catch(e){return console.error("Error deleting folder:",e),n.NextResponse.json({error:"Unexpected error occurred"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/upload/folders/route",pathname:"/api/upload/folders",filename:"route",bundlePath:"app/api/upload/folders/route"},resolvedPagePath:"D:\\Ramy\\RTS\\ReactJS\\divemix-website\\app\\api\\upload\\folders\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:j}=g,S="/api/upload/folders/route";function b(){return(0,l.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:y})}},89145:(e,r,t)=>{"use strict";t.d(r,{O:()=>l});var o=t(72438);let s="https://ilxfqrxybtcftioizoan.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlseGZxcnh5YnRjZnRpb2l6b2FuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NTg5MjMsImV4cCI6MjA2OTQzNDkyM30.Jhjy7136xlqHcVjeCGPDvh4Ofpio3a09Y2fFu2Sqqh0";s||console.warn("Supabase URL not configured properly. Using fallback configuration."),a||console.warn("Supabase Anon Key not configured properly. Using fallback configuration.");let l=(0,o.eI)(s||"https://placeholder.supabase.co",a||"placeholder-key")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5169],()=>t(40852));module.exports=o})();